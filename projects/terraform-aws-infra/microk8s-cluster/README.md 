MicroK8s Kubernetes Cluster on AWS Free Tier
A Terraform configuration to deploy a 3-node Kubernetes cluster using MicroK8s on AWS Free Tier eligible resources.

üìã Overview
This project creates a simple, cost-effective Kubernetes cluster on AWS using:

1 Master Node (t3.micro)

2 Worker Nodes (t3.micro)

MicroK8s for lightweight Kubernetes

Default VPC for simplicity

Free Tier eligible resources (first 12 months)

üèóÔ∏è Architecture
text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           AWS us-east-1 Region          ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îÇ Master  ‚îÇ    ‚îÇ Worker1 ‚îÇ    ‚îÇ Worker2 ‚îÇ
‚îÇ  ‚îÇ t3.micro‚îÇ    ‚îÇ t3.micro‚îÇ    ‚îÇ t3.micro‚îÇ
‚îÇ  ‚îÇ---------‚îÇ    ‚îÇ---------‚îÇ    ‚îÇ---------‚îÇ
‚îÇ  ‚îÇMicroK8s ‚îÇ    ‚îÇMicroK8s ‚îÇ    ‚îÇMicroK8s ‚îÇ
‚îÇ  ‚îÇControl  ‚îÇ    ‚îÇAgent    ‚îÇ    ‚îÇAgent    ‚îÇ
‚îÇ  ‚îÇPlane    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ         ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ       ‚îÇ                ‚îÇ              ‚îÇ
‚îÇ       ‚ñº                ‚ñº              ‚ñº
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îÇ        Default VPC & Subnets           ‚îÇ
‚îÇ  ‚îÇ  Security Group (Ports: 22,6443,30000+)‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚ö° Prerequisites
1. AWS Account
AWS account with Free Tier eligibility

IAM user with programmatic access (Access Key ID & Secret Access Key)

2. Local Tools
Terraform (>= 1.0.0)

AWS CLI

SSH client

Git (optional)

3. AWS CLI Configuration
bash
# Configure AWS CLI with your credentials
aws configure
# Enter: Access Key, Secret Key, Region (us-east-1), Output format (json)
4. SSH Key Pair
bash
# Generate SSH key if you don't have one
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
üöÄ Deployment
Step 1: Clone/Setup Project
bash
# Create project directory
mkdir microk8s-cluster && cd microk8s-cluster

# Create directory structure
mkdir -p user-data

# Copy Terraform files here
# main.tf, variables.tf, outputs.tf, terraform.tfvars
# user-data/master.sh, user-data/worker.sh
Step 2: Initialize Terraform
bash
terraform init
Step 3: Review Plan
bash
terraform plan
Step 4: Deploy Cluster
bash
terraform apply -auto-approve
Step 5: Get Connection Info
bash
terraform output
Save the outputs - especially:

master_public_ip

ssh_command

worker_public_ips

üîß Post-Deployment Setup
1. Connect to Master Node
bash
# Use the output from terraform
ssh -i ~/.ssh/id_rsa ubuntu@<master-public-ip>

# Or if you saved the output
terraform output ssh_command
2. Check MicroK8s Status
bash
# On master node
microk8s status --wait-ready

# Check nodes
microk8s kubectl get nodes
3. Get Join Token for Workers
bash
# On master node
cat /home/ubuntu/join-command.txt
# Copy the output - it looks like:
# microk8s join 10.0.1.100:25000/abc123token
4. Join Worker Nodes
For each worker node:

bash
# SSH to worker node
ssh -i ~/.ssh/id_rsa ubuntu@<worker-public-ip>

# Run the join command from master
microk8s join <master-private-ip>:25000/<token>
5. Verify Cluster
bash
# Back on master node
microk8s kubectl get nodes -o wide
microk8s kubectl get pods -A

# Check cluster info
microk8s kubectl cluster-info
üì¶ Enabled MicroK8s Addons
The master node automatically enables:

DNS (CoreDNS)

Dashboard (Kubernetes Dashboard)

Storage (hostpath storage provisioner)

Registry (Docker registry)

To enable more addons:

bash
microk8s enable ingress
microk8s enable metallb
microk8s enable prometheus
üåê Accessing Services
Kubernetes Dashboard
bash
# On master node
microk8s kubectl port-forward -n kube-system service/kubernetes-dashboard 10443:443
Access: https://localhost:10443

Get Dashboard Token:

bash
microk8s kubectl -n kube-system get secret | grep default-token | awk '{print $1}' | xargs microk8s kubectl -n kube-system describe secret
NodePort Services
Services with NodePort type will be accessible on any node at port range 30000-32767:

bash
# Example: Access service on master
http://<master-public-ip>:30000
üõ†Ô∏è Useful Commands
Terraform Commands
bash
# Update/refresh state
terraform refresh

# Show current resources
terraform show

# Destroy everything
terraform destroy -auto-approve
Kubernetes Commands
bash
# Set alias for convenience
alias kubectl='microk8s kubectl'
alias k='microk8s kubectl'

# Common operations
kubectl get all --all-namespaces
kubectl apply -f deployment.yaml
kubectl logs <pod-name>
kubectl describe pod <pod-name>
MicroK8s Specific
bash
# Check status
microk8s status

# View logs
microk8s inspect

# Add/remove nodes
microk8s add-node
microk8s remove-node

# Reset cluster
microk8s reset
üí∞ Cost Estimation
Free Tier (First 12 Months)
750 hours/month of t3.micro (3 instances = ~720 hours if running 24/7)

30GB of EBS gp3 storage (using 24GB total)

Included: 2 million I/O operations, 1GB snapshot storage

Estimated cost: $0/month (within Free Tier limits)

Post-Free Tier
t3.micro: ~$0.0116/hour = ~$8.50/month per instance

3 instances: ~$25.50/month

EBS storage: ~$2.40/month (24GB √ó $0.10/GB)

Estimated total: ~$28/month

‚ö†Ô∏è Important Notes
Security Considerations
SSH port (22) is open to 0.0.0.0/0 - restrict to your IP in production

Kubernetes API (6443) is publicly accessible

NodePort range (30000-32767) is open

No encryption at rest for etcd data

Use for testing/development only

Resource Limitations
t3.micro has only 1GB RAM - limited workload capacity

Consider upgrading to t3.small (2GB) for production

Monitor memory usage: free -h and kubectl top nodes

Troubleshooting
bash
# If MicroK8s won't start
sudo snap restart microk8s

# Check service status
sudo systemctl status snap.microk8s.*

# View logs
sudo journalctl -u snap.microk8s.daemon-kubelet

# Reset if needed
microk8s reset
üßπ Cleanup
bash
# Destroy all AWS resources
terraform destroy -auto-approve

# Remove local files
rm -rf .terraform terraform.tfstate*
üìö Next Steps
Production Enhancements
Upgrade instance types to t3.small or larger

Create custom VPC with proper networking

Add load balancer for ingress

Configure persistent volumes with EBS

Set up backup with Velero

Implement monitoring with Prometheus/Grafana

Use IAM roles instead of access keys

Set up Auto Scaling for worker nodes

Learning Resources
MicroK8s Documentation

Kubernetes Documentation

Terraform AWS Provider

AWS Free Tier

üÜò Support
Common Issues
"Instance type not available": Change region to us-west-2

"SSH connection refused": Wait 2-3 minutes for instance initialization

"MicroK8s not starting": Check logs with microk8s inspect

"Worker join fails": Regenerate token with microk8s add-node

Debug Commands
bash
# Check instance status
aws ec2 describe-instances --region us-east-1

# View security group
aws ec2 describe-security-groups --group-ids <sg-id>

# Check Terraform state
terraform state list
üìÑ License
This project is for educational purposes. Use at your own risk in production environments.

Created with Terraform + AWS + MicroK8s
Perfect for learning Kubernetes on a budget!

Quick Start Cheat Sheet
bash
# Deploy
terraform init && terraform apply -auto-approve

# Connect
ssh -i ~/.ssh/id_rsa ubuntu@$(terraform output -raw master_public_ip)

# Join workers
# 1. Get token from master: cat /home/ubuntu/join-command.txt
# 2. SSH to each worker and run the command

# Verify
microk8s kubectl get nodes && microk8s kubectl get pods -A

# Cleanup
terraform destroy -auto-approve
Enjoy your Kubernetes cluster! üéâ

