apiVersion: v1
kind: Pod
metadata:
  name: seccomp-restricted-pod
  namespace: pod-security-lab
  annotations:
    cks.exercise: "04-pod-security-context"
    cks.section: "03-seccomp-profile"
spec:
  securityContext:
    seccompProfile:
      type: RuntimeDefault  # Modern way (replaces annotation)
    runAsNonRoot: true
    runAsUser: 1000
  containers:
  - name: app
    image: busybox:latest
    command: ["sleep", "3600"]
    securityContext:
      allowPrivilegeEscalation: false
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: custom-seccomp-profile
  namespace: pod-security-lab
data:
  custom-profile.json: |
    {
      "defaultAction": "SCMP_ACT_ERRNO",
      "architectures": [
        "SCMP_ARCH_X86_64",
        "SCMP_ARCH_X86",
        "SCMP_ARCH_X32"
      ],
      "syscalls": [
        {
          "names": [
            "accept",
            "epoll_wait",
            "read",
            "write",
            "close",
            "mmap"
          ],
          "action": "SCMP_ACT_ALLOW"
        }
      ]
    }
---
apiVersion: v1
kind: Pod
metadata:
  name: custom-seccomp-pod
  namespace: pod-security-lab
spec:
  securityContext:
    seccompProfile:
      type: Localhost
      localhostProfile: profiles/custom-profile.json
  containers:
  - name: app
    image: busybox:latest
    command: ["sleep", "3600"]