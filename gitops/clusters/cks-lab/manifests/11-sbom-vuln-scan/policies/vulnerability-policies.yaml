apiVersion: v1
kind: ConfigMap
metadata:
  name: vulnerability-policies
  namespace: sbom-system
data:
  policies.yaml: |
    # Vulnerability scanning policies
    policies:
      - name: critical-vulnerabilities
        description: "Block deployment of images with critical vulnerabilities"
        rules:
          - type: vulnerability
            severity: CRITICAL
            action: block
            exceptions:
              - cve: "CVE-2023-XXXXX"
                reason: "False positive, confirmed by security team"
                expiry: "2024-12-31"
      
      - name: high-vulnerabilities
        description: "Warn on high severity vulnerabilities"
        rules:
          - type: vulnerability
            severity: HIGH
            action: warn
            max_count: 5
      
      - name: base-image-requirements
        description: "Requirements for base images"
        rules:
          - type: base-image
            allowed_images:
              - "alpine:3.*"
              - "debian:11.*"
              - "ubuntu:22.04"
              - "distroless/*"
            blocked_images:
              - "latest"
              - "*:latest"
      
      - name: package-requirements
        description: "Package-specific policies"
        rules:
          - type: package
            name: "openssl"
            min_version: "1.1.1"
            action: block
            
          - type: package
            name: "glibc"
            min_version: "2.28"
            action: warn
      
      - name: compliance-requirements
        description: "Compliance framework requirements"
        rules:
          - type: compliance
            framework: "PCI-DSS"
            requirements:
              - no_critical_vulnerabilities: true
              - sbom_required: true
              - signed_images: true
            
          - type: compliance
            framework: "HIPAA"
            requirements:
              - encrypted_images: true
              - audit_logging: true